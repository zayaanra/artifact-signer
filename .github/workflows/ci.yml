name: continuous-integration
on: [push]
jobs:
    ci:
        runs-on: ubuntu-latest
        
        steps:
            - uses: actions/checkout@v4
            - name: Install Python
            
              uses: actions/setup-python@v5
              with:
                python-version: "3.10"
            
            - name: Install Poetry
              uses: snok/install-poetry@v1
            
            - name: Install dependencies
              run: |
                python -m pip install --upgrade pip
                pip install ruff black bandit pytest-cov
                poetry install -C python-artifact-signer/ --no-interaction --no-root


            - name: Run Black
              run: |
                black --check python-artifact-signer/python_artifact_signer

            - name: Run ruff
              run: |
                ruff check python-artifact-signer/python_artifact_signer

            - name: Run Bandit
              run: |
                bandit -r python-artifact-signer/python_artifact_signer

            # - name: Run TruffleHog
            #   uses: trufflesecurity/trufflehog-actions-scan@v2
            #   with:
            #     scan-directory: './'
            #     github-token: ${{ secrets.GITHUB_TOKEN }}
            
            - name: Run Pytest
              run: |
                PYTHONPATH=python-artifact-signer/ pytest --cov
              

